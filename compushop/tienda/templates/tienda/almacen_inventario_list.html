{% extends "cuentas/personal_dashboard.html" %}
{% load i18n %}

{% block title %}{% trans "Inventario" %}{% endblock %}

{% block dashboard_content %}
<div class="container my-4">

  <h3 class="mb-4 text-primary fw-bold">
    {% trans "Inventario" %}
    {% if modo_lectura %}
      <small class="text-muted">({% trans "acceso extendido â€” ventas" %})</small>
    {% endif %}
  </h3>

  {% if modo_lectura %}
    <div class="alert alert-info text-center mb-4">
      ðŸ”’ {% trans "Modo solo lectura: No puedes ajustar el stock desde este acceso." %}
    </div>
  {% endif %}

  {% if alertas and not modo_lectura %}
    <div class="alert alert-warning mb-4">
      <strong>âš  {% trans "Productos con bajo stock" %}:</strong>
      <ul class="mb-0 mt-2">
        {% for p in alertas %}
          <li>{{ p.nombre }} â€” {% trans "Stock" %}: {{ p.stock }} / {% trans "MÃ­nimo" %}: {{ p.stock_minimo }}</li>
        {% endfor %}
      </ul>
    </div>

  {% elif modo_lectura and alertas %}
    <div class="alert alert-info mb-4">
      <strong>ðŸ“¦ {% trans "Vista extendida: Productos con bajo stock" %}</strong>
      <ul class="mb-0 mt-2">
        {% for p in alertas %}
          <li>{{ p.nombre }} â€” {% trans "Stock" %}: {{ p.stock }} / {% trans "MÃ­nimo" %}: {{ p.stock_minimo }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <table class="table table-sm table-hover align-middle shadow-sm">
    <thead class="table-dark">
      <tr>
        <th>{% trans "Producto" %}</th>
        <th>{% trans "Proveedor" %}</th>
        <th>{% trans "Stock" %}</th>
        <th>{% trans "MÃ­n." %}</th>
        <th>{% trans "Disp." %}</th>
        <th class="text-center">{% trans "Acciones" %}</th>
      </tr>
    </thead>
    <tbody>
      {% for p in producto %}
      <tr class="{% if p.stock <= p.stock_minimo %}table-warning{% endif %}">
        <td>{{ p.nombre }}</td>
        <td>{{ p.proveedor }}</td>
        <td>{{ p.stock }}</td>
        <td>{{ p.stock_minimo }}</td>
        <td>{{ p.disponible|yesno:"SÃ­,No" }}</td>
        <td class="text-center">
          {% if not modo_lectura %}
            <a class="btn btn-sm btn-primary px-3" href="{% url 'almacen:ajustar' p.id %}">
              <i class="bi bi-pencil-square me-1"></i> {% trans "Ajustar" %}
            </a>
          {% else %}
            <button class="btn btn-sm btn-secondary px-3" disabled
                    title="{% trans 'Solo lectura para ventas' %}">
              <i class="bi bi-lock-fill me-1"></i> {% trans "Ajustar" %}
            </button>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center text-muted py-3">
          {% trans "Sin resultados disponibles." %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
