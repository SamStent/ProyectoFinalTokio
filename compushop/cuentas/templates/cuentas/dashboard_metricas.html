{% extends "cuentas/personal_dashboard.html" %}
{% load static %}

{% block title %}Dashboard de métricas{% endblock %}

{% block dashboard_content %}
<div class="container my-5">
  <h2 class="text-center mb-4">📊 Dashboard de Métricas Internas</h2>

  {% if not metricas %}
    <div class="alert alert-info text-center">
      No tienes métricas activadas actualmente. Ve a la
      <a href="{% url 'cuentas:config_panel' %}" class="alert-link">configuración del panel</a>
      para seleccionarlas.
    </div>
  {% endif %}

  <div class="row">

    {# === Valor total de stock (SOLO si hay contenido) === #}
    {% if grafico_valor_stock_html %}
    <div class="col-lg-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          Valor total de stock por proveedor
        </div>
        <div class="card-body">
          {{ grafico_valor_stock_html|safe }}
        </div>
      </div>
    </div>
    {% endif %}

    {# === Existencias por proveedor (ALMACÉN) === #}
    {% if grafico_stock_html %}
    <div class="col-lg-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          Existencias por proveedor
        </div>
        <div class="card-body">
          {{ grafico_stock_html|safe }}
        </div>
      </div>
    </div>
    {% endif %}

    {% if grafico_precios_html %}
    <div class="col-lg-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          Precio medio por proveedor
        </div>
        <div class="card-body">
          {{ grafico_precios_html|safe }}
        </div>
      </div>
    </div>
    {% endif %}

    {# === Distribución del stock === #}
    {% if grafico_distribucion_stock_html %}
    <div class="col-lg-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">
          Distribución del stock
        </div>
        <div class="card-body">
          {{ grafico_distribucion_stock_html|safe }}
        </div>
      </div>
    </div>
    {% endif %}

    {% if grafico_rendimiento_html %}
    <div class="col-lg-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">
          Rendimiento por proveedor
        </div>
        <div class="card-body">
          {{ grafico_rendimiento_html|safe }}
        </div>
      </div>
    </div>
    {% endif %}

    {# === Rotación === #}
    {% if grafico_rotacion_html %}
    <div class="col-lg-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-secondary text-white">
          Rotación estimada de productos
        </div>
        <div class="card-body">
          {{ grafico_rotacion_html|safe }}
        </div>
      </div>
    </div>
    {% endif %}    

    {# === Alertas === #}
    {% if alertas_stock_html %}
    <div class="col-12">
      <div class="card shadow-sm border-danger">
        <div class="card-header bg-danger text-white">
          Productos con bajo nivel de stock
        </div>
        <div class="card-body">
          {{ alertas_stock_html|safe }}
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
